(function(f,j,i){var k=function(){},h=j.Notifier=j.Model.extend({defaults:{baseCls:"notifier",types:["warning","error","info","success"],dialog:!1,theme:"plastic",message:"",closeBtn:!1,title:void 0,hideOnClick:!0,type:null,cls:null,ms:1E4,loader:!1,destroy:!1,modal:!1,opacity:1,offsetY:0,fadeInMs:500,fadeOutMs:500,position:"top",screenOpacity:0.65,zIndex:1E4,width:void 0,modules:void 0},transitions:{top:{"in":function(a,b,c,d,g){a.css({display:"block",top:-1E3});a.css({top:-b.innerHeight()}).animate({top:c.offsetY,
opacity:c.opacity},d,g||k)},out:function(a,b,c,d,g){a.animate({top:-b.innerHeight(),opacity:0},d,g||k)}},center:{"in":function(a,b,c,d,g){a.css({top:c.offsetY-40,display:"block"}).animate({top:"50%",marginTop:-b.innerHeight()/2,opacity:c.opacity},d,g||k)},out:function(a,b,c,d,g){a.animate({top:"0%",opacity:0},d,g||k)}},bottom:{"in":function(a,b,c,d,g){a.css({bottom:c.offsetY-40,top:"auto",display:"block"}).animate({bottom:b.innerHeight()+c.offsetY,opacity:c.opacity},d,g||k)},out:function(a,b,c,d,
g){a.animate({bottom:-b.height(),opacity:0},d,g||k)}}},template:function(a){var b=['<div class="'+a.wrapperCls+'">','<div class="'+a.innerCls+'">',a.title?'<div class="'+a.baseCls+'-title">'+a.title+"</div>":"",a.closeBtn?'<button class="'+a.baseCls+'-close" data-handler="destroy"><span>x</span></button>':""];a.dialog?b.push('<div class="'+a.baseCls+'-message">'+a.message+(a.loader?'<div class="'+a.baseCls+'-loader"></div>':"")+"</div>"):b.push('<div class="'+a.baseCls+'-message">'+a.message+"</div>",
a.loader?'<div class="'+a.baseCls+'-loader"></div>':"");if(a.buttons){var c=f("<div />");i.each(a.buttons,function(a){c.append(f("<button/>",a))});b.push('<div class="'+a.baseCls+'-btns">'+c.html()+"</div>")}b.push("</div></div>");return b.join("")},initEl:function(){var a=this.el?this.el:"body",a=i.isObject(a)?a:f(a);if(!a.length)return f(f.proxy(this.initEl,this));this.$el=a;this._cssPos=a.get(0)===document.body?"fixed":"absolute";a.get(0)!==document.body&&a.css("position","relative");"absolute"===
this._cssPos&&a.css("overflow","hidden")},initialize:function(a){var b=this;this.el=a&&a.el;this.initEl.call(this,a&&a.el);this.current={};b.NotificationView=j.View.extend({defaults:b.attributes,on:function(a,b){var c=b,d=this;i.isString(b)&&(c=function(){d[b].apply(d,arguments)});return j.View.prototype.on.call(this,a,c)}});var c=function(a){b[a]=b[a]||function(c){i.isString(c)&&(c={message:c});c=i.extend({},{type:""},c);c.type=c.type?a+" "+c.type:a;return b.notify(c)}};i.each(b.attributes.types,
function(a){c(a)});if(b.attributes){var d=this.attributes.modules;d&&f.each(d,function(a,b){b.name=i.isArray(d)?b.name:a;h.regModule(b)});b.attributes.modules=void 0}},calcZIndex:function(){if("absolute"===this._cssPos)return this.attributes.zIndex;var a=this.attributes.zIndex+1;i.each(this.current,function(b){a=b.zIndex>a?b.zIndex:a});return++a},destroyAll:function(a,b){var c=0;i.isFunction(a)?i.each(this.current,function(b){a(b)&&(b.destroy.call(b),c++)}):void 0!==a?i.each(this.current,function(d){d.settings[a]===
b&&(d.destroy.call(d),c++)}):i.each(this.current,function(a){a.destroy.call(a);c++});return c},getWrapperCls:function(a){return f.trim(a.baseCls+" "+(a.type?a.type+" ":"")+("theme-"+a.theme+" ")+(a.dialog?"dialog ":"")+("pos-"+a.position+" ")+(a.buttons?"with-buttons ":"")+(a.loader?"with-loader ":"")+(a.closeBtn?"with-close-btn ":"")).split(" ").join(" "+a.baseCls+"-")+" "+(a.cls||"")},getSettings:function(a){i.isString(a)&&(a={message:a});var b=f.extend({},this.attributes,a);b.title&&void 0===a.dialog&&
(b.dialog=!0);if((b.modal||b.dialog)&&void 0===a.hideOnClick)b.hideOnClick=!1;b.dialog&&void 0===a.ms&&(b.ms=null);b.dialog&&void 0===a.position&&(b.position="center");return b},notify:function(a){a=a||{};a.el&&(this.el=a&&a.el,this.initEl.call(this,a&&a.el));var b=this,c=this.getSettings(a);i.isObject(c.destroy)?c.destroy instanceof b.NotificationView?c.destroy.destroy():b.destroyAll.apply(b,i.isArray(c.destroy)?c.destroy:[c.destroy]):!0===c.destroy&&b.destroyAll();a=a.zIndex||b.calcZIndex.call(b);
c.wrapperCls=b.getWrapperCls(c);c.innerCls=c.baseCls+"-inner";var d=f(b.template(c)),g=d.find("."+c.innerCls);c.width&&g.css({width:c.width});h._modulesBinder.trigger("beforeAppendMsgEl",b,c,d,g);d.css({display:"none",opacity:0,position:b._cssPos,zIndex:c.modal?++a:a}).prependTo(b.$el);var e=new b.NotificationView({el:d});e.settings=c;if(c.buttons||g.find("button").length)g.on("click","button[data-handler]",function(){var a=f(this).data("handler");(i.isFunction(a)?a:e[a]).apply(e,arguments)}),g.on("button click",
function(a){e.trigger("click:"+f(a.target).data("role"))});var k=e.destroy=function(a){if(i.isObject(a)&&a.preventDefault){a.preventDefault();a.stopPropagation()}e.trigger("beforeHide",e,d);c.modal&&e.screenEl.fadeOut(300,function(){e.trigger("screenHide",e,d);e.screenEl.remove()});h._modulesBinder.trigger("beforeHideMsgEl",b,c,d,g,e);(f.isFunction(c.out)?c.out:b.transitions[c.position].out).call(b,d,g,c,c.fadeOutMs,function(){e.remove();e.trigger("destroy",e,d);h._modulesBinder.trigger("afterDestroyMsgEl",
b,c,d,g,e);i.isFunction(a)&&a.call(e,e,d)});e.timeoutId&&clearTimeout(e.timeoutId);delete e.timeoutId;delete b.current[e.cid]},j=function(a){if(a){a.preventDefault();a.stopPropagation()}};c.modal&&(e.screenEl=f("<div/>",{"class":c.baseCls+"-screen "+c.baseCls+"-theme-"+c.theme,css:{position:b._cssPos,top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:a-1}}).prependTo(b.$el).click(function(a){a.preventDefault();a.stopPropagation();return false}).fadeTo(300,c.screenOpacity));if(0<c.ms||0===c.ms)e.timeoutId=
setTimeout(function(){e.trigger("timeout",e,d);k()},c.ms);g.click(c.hideOnClick?k:j);c.css&&g.css(c.css);j=f.isFunction(c["in"])?c["in"]:b.transitions[c.position]["in"];b.current[e.cid]=e;e.zIndex=a;h._modulesBinder.trigger("beforeAnimateInMsgEl",b,c,d,g,e);j.call(b,d,g,c,c.fadeInMs,function(){h._modulesBinder.trigger("afterAnimateInMsgEl",b,c,d,g,e)});return e}});h.getModule=function(a){return i.isObject(a)?a:h.modules[a]};var l={},m=Array.prototype.shift;i.extend(l,j.Events);h._modulesBinder=l;
h.regModule=function(a,b){1===arguments.length?(b=f.isFunction(a)?a():a,a=b.name):(b=f.isFunction(b)?b():b,b.name=a);if(!a)throw"module name is not defined.";b.extend&&f.each(b.extend,function(a,d){var g=h.prototype[a];h.prototype[a]=i.isFunction(d)||g===void 0?function(){return d.apply({scope:this,supr:g,module:b},arguments)}:i.isObject(d)?f.extend(true,{},g,d):d});(h.modules=h.modules||{})[a]=b;f.isFunction(b.register)&&b.register.call(b,h);b.enabled&&h.enableModule(b);return b};h.enableModule=
function(a){var b=h.getModule(a);return b?(b._handlers=b._handlers||{},b.events&&f.each(b.events,function(a,d){var g=b._handlers[a]=function(){var a=m.call(arguments);d.apply({module:b,scope:a},arguments)};h._modulesBinder.on(a,g)}),b.enabled=!0,f.isFunction(b.enable)&&b.enable.call(b,h),b):!1};h.disableModule=function(a){return(a=h.getModule(a))?(f.each(a._handlers,function(a,c){h._modulesBinder.off(a,c)}),a.enabled=!1,f.isFunction(a.disable)&&a.disable.call(a,h),a):!1}})(jQuery,Backbone,_);
(function(f,j,i){f.regModule({name:"template",enabled:!0,extend:{template:function(f){if(f.data){var h=i.template(f.message);f.message=h(f.data)}return this.supr.call(this.scope,f)}}})})(Backbone.Notifier,jQuery,_);
